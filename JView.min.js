class JView{constructor(e,t){this._dom={},this._dom.container=e,this._dom.container.classList.add("jv"),!1!==t&&this.build(JSON.parse(this._dom.container.textContent.trim()),null,1)}build(e,t,n){t="number"==typeof t?t:-1,n="number"==typeof n?n:-1;const s=this._processInput(e),i=this._walk(s,t,n,0);this._dom.container.innerHTML="",this._dom.container.appendChild(i)}_processInput(e){if(e&&"object"==typeof e)return e;throw"Input value is not object or array!"}_walk(e,t,n,s){const i=document.createDocumentFragment(),a=t>=0&&s>=t,l=n>=0&&s>=n;switch(typeof e){case"object":if(!e)break;const c=Array.isArray(e),d=c?e:Object.keys(e);if(0===s){const e=this._createItemsCount(d.length),t=this._createLink(c?"[":"{");d.length?(t.addEventListener("click",function(){a||(t.classList.toggle("collapsed"),e.classList.toggle("hide"),this._dom.container.querySelector("ul").classList.toggle("hide"))}.bind(this)),l&&(t.classList.add("collapsed"),e.classList.remove("hide"))):t.classList.add("empty"),t.appendChild(e),i.appendChild(t)}if(d.length&&!a){const a=d.length-1,l=document.createElement("ul");l.setAttribute("data-level",s),l.classList.add("type-"+(c?"array":"object")),d.forEach(function(i,d){const o=c?i:e[i],r=document.createElement("li");if("object"==typeof o){if(!o||o instanceof Date)r.appendChild(document.createTextNode(c?"":i+": ")),r.appendChild(this._createSimple(o||null));else{const e=Array.isArray(o),a=e?o.length:Object.keys(o).length;if(a){const l=("string"==typeof i?i+": ":"")+(e?"[":"{"),c=this._createLink(l),d=this._createItemsCount(a);t>=0&&s+1>=t?r.appendChild(document.createTextNode(l)):(c.appendChild(d),r.appendChild(c)),r.appendChild(this._walk(o,t,n,s+1)),r.appendChild(document.createTextNode(e?"]":"}"));const p=r.querySelector("ul"),h=function(){c.classList.toggle("collapsed"),d.classList.toggle("hide"),p.classList.toggle("hide")};c.addEventListener("click",h),n>=0&&s+1>=n&&h()}else r.appendChild(document.createTextNode(i+": "+(e?"[]":"{}")))}}else c||r.appendChild(document.createTextNode(i+": ")),r.appendChild(this._walk(o,t,n,s+1));d<a&&r.appendChild(document.createTextNode(",")),l.appendChild(r)},this),i.appendChild(l)}else if(d.length&&a){const e=this._createItemsCount(d.length);e.classList.remove("hide"),i.appendChild(e)}if(0===s){if(!d.length){const e=this._createItemsCount(0);e.classList.remove("hide"),i.appendChild(e)}i.appendChild(document.createTextNode(c?"]":"}")),l&&i.querySelector("ul").classList.add("hide")}break;default:i.appendChild(this._createSimple(e))}return i}_createSimple(e){const t=document.createElement("span");let n=typeof e,s=e;return"string"===n?s='"'+e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+'"':null===e?(n="null",s="null"):void 0===e?s="undefined":e instanceof Date&&(n="date",s=e.toString()),t.classList.add("type-"+n),t.innerHTML=s,t}_createItemsCount(e){const t=document.createElement("span");return t.classList.add("items-ph"),t.classList.add("hide"),t.innerHTML=this._getItemsTitle(e),t}_createLink(e){const t=document.createElement("a");return t.classList.add("list-link"),t.href="javascript:void(0)",t.innerHTML=e||"",t}_getItemsTitle(e){return e+" "+(e>1||0===e?"items":"item")}}
