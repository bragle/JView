class JView{constructor(e,t){if(this._dom={},this._dom.container=e,this._dom.container.classList.add("jv"),!1===t)return;const n=this._dom.container.textContent.trim();if(!n)return;let s;try{s=JSON.parse(n)}catch(e){return}this.build(s,null,1)}build(e,t,n){t="number"==typeof t?t:-1,n="number"==typeof n?n:-1;const s=this._processInput(e),i=this._walk(s,t,n,0);this._dom.container.innerHTML="",this._dom.container.appendChild(i)}_processInput(e){if(e&&"object"==typeof e)return e;throw"Input value is not object or array!"}_walk(e,t,n,s){const i=document.createDocumentFragment(),a=t>=0&&s>=t,c=n>=0&&s>=n;switch(typeof e){case"object":if(!e)break;const l=Array.isArray(e),d=l?e:Object.keys(e);if(0===s){const e=this._createItemsCount(d.length),t=this._createLink(l?"[":"{");d.length?(t.addEventListener("click",function(){a||(t.classList.toggle("collapsed"),e.classList.toggle("hide"),this._dom.container.querySelector("ul").classList.toggle("hide"))}.bind(this)),c&&(t.classList.add("collapsed"),e.classList.remove("hide"))):t.classList.add("empty"),t.appendChild(e),i.appendChild(t)}if(d.length&&!a){const a=d.length-1,c=document.createElement("ul");c.setAttribute("data-level",s),c.classList.add("type-"+(l?"array":"object")),d.forEach(function(i,d){const r=l?i:e[i],o=document.createElement("li");if("object"==typeof r){if(!r||r instanceof Date)o.appendChild(document.createTextNode(l?"":i+": ")),o.appendChild(this._createSimple(r||null));else{const e=Array.isArray(r),a=e?r.length:Object.keys(r).length;if(a){const c=("string"==typeof i?i+": ":"")+(e?"[":"{"),l=this._createLink(c),d=this._createItemsCount(a);t>=0&&s+1>=t?o.appendChild(document.createTextNode(c)):(l.appendChild(d),o.appendChild(l)),o.appendChild(this._walk(r,t,n,s+1)),o.appendChild(document.createTextNode(e?"]":"}"));const p=o.querySelector("ul"),h=function(){l.classList.toggle("collapsed"),d.classList.toggle("hide"),p.classList.toggle("hide")};l.addEventListener("click",h),n>=0&&s+1>=n&&h()}else o.appendChild(document.createTextNode(i+": "+(e?"[]":"{}")))}}else l||o.appendChild(document.createTextNode(i+": ")),o.appendChild(this._walk(r,t,n,s+1));d<a&&o.appendChild(document.createTextNode(",")),c.appendChild(o)},this),i.appendChild(c)}else if(d.length&&a){const e=this._createItemsCount(d.length);e.classList.remove("hide"),i.appendChild(e)}if(0===s){if(!d.length){const e=this._createItemsCount(0);e.classList.remove("hide"),i.appendChild(e)}i.appendChild(document.createTextNode(l?"]":"}")),c&&i.querySelector("ul").classList.add("hide")}break;default:i.appendChild(this._createSimple(e))}return i}_createSimple(e){const t=document.createElement("span");let n=typeof e,s=e;return"string"===n?s='"'+e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+'"':null===e?(n="null",s="null"):void 0===e?s="undefined":e instanceof Date&&(n="date",s=e.toString()),t.classList.add("type-"+n),t.innerHTML=s,t}_createItemsCount(e){const t=document.createElement("span");return t.classList.add("items-ph"),t.classList.add("hide"),t.innerHTML=this._getItemsTitle(e),t}_createLink(e){const t=document.createElement("a");return t.classList.add("list-link"),t.href="javascript:void(0)",t.innerHTML=e||"",t}_getItemsTitle(e){return e+" "+(e>1||0===e?"items":"item")}}